--CREAR TABLAS
CREATE TABLE VAGON(
    codigo_tren VARCHAR(10),
    orden NUMBER(2),
    modelo VARCHAR2(10),
    anno_fab NUMBER(4),
        CONSTRAINT PK_VAGON PRIMARY KEY(codigo_tren, orden),
        CONSTRAINT ORDEN_MIN_MAX CHECK(orden BETWEEN 1 AND 20),
        CONSTRAINT ANNO_FAB_MIN CHECK(anno_fab > 2015)
);

CREATE TABLE EXTINTOR(
    num_ref NUMBER(4),
    codigo_tren VARCHAR(10),
    orden NUMBER(2),
        CONSTRAINT PK_EXTINTOR PRIMARY KEY(num_ref),
        CONSTRAINT FK_EXTINTOR_VAGON FOREIGN KEY(codigo_tren, orden)
            REFERENCES VAGON(codigo_tren, orden)
);

--REVISAR CONSTRAINTS
SELECT * FROM USER_CONSTRAINTS 
    WHERE TABLE_NAME='VAGON' OR TABLE_NAME='EXTINTOR'
    ORDER BY TABLE_NAME ASC;
SELECT * FROM USER_CONS_COLUMNS 
    WHERE TABLE_NAME='VAGON' OR TABLE_NAME='EXTINTOR'
    ORDER BY TABLE_NAME ASC;

--INSERTAR DATOS
/* TREN 120A - VAGONES */
INSERT INTO VAGON VALUES('120A', 1, 'D-2866 LUE', 2018);
INSERT INTO VAGON VALUES('120A', 2, 'H-333 DUE', 2020);
INSERT INTO VAGON VALUES('120A', 3, 'D-2866 LUE', 2020);
/* TREN 120A - EXTINTORES */
INSERT INTO EXTINTOR VALUES(1000,'120A',1);
INSERT INTO EXTINTOR VALUES(6700,'120A',2);
INSERT INTO EXTINTOR VALUES(4560,'120A',3);
INSERT INTO EXTINTOR VALUES(1902,'120A',3);

/* TREN 033B - VAGONES */
INSERT INTO VAGON VALUES('033B', 1, 'H-333 DUE', 2018);
INSERT INTO VAGON VALUES('033B', 2, 'H-333 DUE', 2020);
INSERT INTO VAGON VALUES('033B', 3, 'H-333 DUE', 2020);
INSERT INTO VAGON VALUES('033B', 4, 'H-333 DUE', 2020);
/* TREN 033B - EXTINTORES */
INSERT INTO EXTINTOR VALUES(0145,'033B',1);
INSERT INTO EXTINTOR VALUES(0034,'033B',1);
INSERT INTO EXTINTOR VALUES(3321,'033B',2);
INSERT INTO EXTINTOR VALUES(7771,'033B',4);
INSERT INTO EXTINTOR VALUES(1802,'033B',4);

--VISUALIZAR DATOS
/* TABLA VAGON */
SELECT * FROM VAGON;
/* TABLA EXTINTOR */
SELECT * FROM EXTINTOR;

--INSERTAR DATOS NO VÁLIDOS
INSERT INTO VAGON VALUES('120A', 21, 'D-2866 LUE', 2020); /* CHECK ORDEN_MIN_MAX*/
INSERT INTO VAGON VALUES('120A', 4, 'D-2866 LUE', 2015); /* CHECK ANNO_FAB_MIN */
INSERT INTO VAGON VALUES('120A', 3, 'D-2866 LUE', 2020); /* PK PK_VAGON */
INSERT INTO EXTINTOR VALUES(1902, '120A', 3); /* PK PK_EXTINTOR */
INSERT INTO EXTINTOR VALUES(1903, '120A', 4); /* FK FK_EXTINTOR_VAGON */